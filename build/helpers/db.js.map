{"version":3,"sources":["../../server/helpers/db.js"],"names":["PRODUCTION_DB","TEST_DB","MODE_TEST","MODE_PRODUCTION","state","pool","mode","connect","done","createPool","host","process","env","DATABASE_URL","user","MYSQL_USERNAME","password","MYSQL_PASSWORD","database","ssl","ca","readFileSync","__dirname","get","disconnect","end","queryAsync","query","params","resolve","reject","err","rows"],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;AACA;;;;;;AAEO,IAAMA,wCAAgB,aAAtB;AACA,IAAMC,4BAAU,aAAhB;;AAEA,IAAMC,gCAAY,WAAlB;AACA,IAAMC,4CAAkB,iBAAxB;;AAEP,IAAIC,QAAQ;AACVC,QAAM,IADI;AAEVC,QAAM;AAFI,CAAZ;;AAKA,IAAMC,UAAU,SAAVA,OAAU,CAACD,IAAD,EAAOE,IAAP,EAAgB;AAC9BJ,QAAMC,IAAN,GAAa,gBAAMI,UAAN,CAAiB;AAC5BC,UAAMJ,SAASH,eAAT,GAA2BQ,QAAQC,GAAR,CAAYC,YAAvC,GAAsD,WADhC;AAE5BC,UAAMR,SAASH,eAAT,GAA2BQ,QAAQC,GAAR,CAAYG,cAAvC,GAAwD,MAFlC;AAG5BC,cAAUL,QAAQC,GAAR,CAAYK,cAHM;AAI5BC,cAAUZ,SAASH,eAAT,GAA2BH,aAA3B,GAA2CC,OAJzB;AAK5BkB,SAAK;AACHC,UAAI,aAAGC,YAAH,CAAgBC,YAAY,sCAA5B;AADD;AALuB,GAAjB,CAAb;;AAUAlB,QAAME,IAAN,GAAaA,IAAb;AACAE;AACD,CAbD;;AAeA,IAAMe,MAAM,SAANA,GAAM;AAAA,SAAMnB,MAAMC,IAAZ;AAAA,CAAZ;;AAEA,IAAMmB,aAAa,SAAbA,UAAa,GAAM;AACvBD,QAAME,GAAN;AACD,CAFD;;AAIA,IAAMC;AAAA,wEAAa,iBAAOC,KAAP,EAAcC,MAAd;AAAA;AAAA;AAAA;AAAA;AAAA,6CACV,sBAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC1B,oBAAMC,IAAN,CAAWsB,KAAX,CAAiBA,KAAjB,EAAwBC,MAAxB,EAAgC,UAACG,GAAD,EAAMC,IAAN,EAAe;AAC7C,oBAAID,GAAJ,EAASD,OAAOC,GAAP,EAAT,KACKF,QAAQG,IAAR;AACN,eAHD;AAID,aALM,CADU;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAb;;AAAA;AAAA;AAAA;AAAA,GAAN;;kBASe;AACbzB,kBADa;AAEbgB,UAFa;AAGbG,wBAHa;AAIbF;AAJa,C","file":"db.js","sourcesContent":["import mysql from 'mysql';\nimport async from 'async';\nimport fs from 'fs';\n\nexport const PRODUCTION_DB = 'atlargeprod';\nexport const TEST_DB = 'atlargetest';\n\nexport const MODE_TEST = 'MODE_TEST';\nexport const MODE_PRODUCTION = 'MODE_PRODUCTION';\n\nlet state = {\n  pool: null,\n  mode: null,\n};\n\nconst connect = (mode, done) => {\n  state.pool = mysql.createPool({\n    host: mode === MODE_PRODUCTION ? process.env.DATABASE_URL : 'localhost',\n    user: mode === MODE_PRODUCTION ? process.env.MYSQL_USERNAME : 'root',\n    password: process.env.MYSQL_PASSWORD,\n    database: mode === MODE_PRODUCTION ? PRODUCTION_DB : TEST_DB,\n    ssl: {\n      ca: fs.readFileSync(__dirname + '/../../config/amazon-rds-ca-cert.pem'),\n    },\n  });\n\n  state.mode = mode;\n  done();\n};\n\nconst get = () => state.pool;\n\nconst disconnect = () => {\n  get().end();\n};\n\nconst queryAsync = async (query, params) => {\n  return new Promise((resolve, reject) => {\n    state.pool.query(query, params, (err, rows) => {\n      if (err) reject(err);\n      else resolve(rows);\n    });\n  });\n};\n\nexport default {\n  connect,\n  get,\n  queryAsync,\n  disconnect,\n};\n"]}