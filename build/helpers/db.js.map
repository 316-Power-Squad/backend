{"version":3,"sources":["../../server/helpers/db.js"],"names":["TEST_DB","PRODUCTION_DB","process","env","MODE_TEST","MODE_PRODUCTION","state","pool","mode","connect","done","config","host","DATABASE_HOST","user","MYSQL_USERNAME","password","MYSQL_PASSWORD","database","console","log","createPool","get","disconnect","end","queryAsync","query","params","resolve","reject","err","rows"],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;AACA;;;;;;AAEO,IAAMA,4BAAU,aAAhB;AACA,IAAMC,wCAAgBC,QAAQC,GAAR,CAAYF,aAAlC;;AAEA,IAAMG,gCAAY,WAAlB;AACA,IAAMC,4CAAkB,iBAAxB;;AAEP,IAAIC,QAAQ;AACVC,QAAM,IADI;AAEVC,QAAM;AAFI,CAAZ;;AAKA,IAAMC,UAAU,SAAVA,OAAU,CAACD,IAAD,EAAOE,IAAP,EAAgB;AAC9B,MAAMC,SAAS;AACbC,UAAMJ,SAASH,eAAT,GAA2BH,QAAQC,GAAR,CAAYU,aAAvC,GAAuD,WADhD;AAEbC,UAAMN,SAASH,eAAT,GAA2BH,QAAQC,GAAR,CAAYY,cAAvC,GAAwD,MAFjD;AAGbC,cAAUd,QAAQC,GAAR,CAAYc,cAHT;AAIbC,cAAUV,SAASH,eAAT,GAA2BJ,aAA3B,GAA2CD;AAJxC,GAAf;;AAOAmB,UAAQC,GAAR,CAAYT,MAAZ;;AAEAL,QAAMC,IAAN,GAAa,gBAAMc,UAAN,CAAiBV,MAAjB,CAAb;AACAL,QAAME,IAAN,GAAaA,IAAb;AACAE;AACD,CAbD;;AAeA,IAAMY,MAAM,SAANA,GAAM;AAAA,SAAMhB,MAAMC,IAAZ;AAAA,CAAZ;;AAEA,IAAMgB,aAAa,SAAbA,UAAa,GAAM;AACvBD,QAAME,GAAN;AACD,CAFD;;AAIA,IAAMC;AAAA,wEAAa,iBAAOC,KAAP,EAAcC,MAAd;AAAA;AAAA;AAAA;AAAA;AAAA,6CACV,sBAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtCvB,oBAAMC,IAAN,CAAWmB,KAAX,CAAiBA,KAAjB,EAAwBC,MAAxB,EAAgC,UAACG,GAAD,EAAMC,IAAN,EAAe;AAC7C,oBAAID,GAAJ,EAASD,OAAOC,GAAP,EAAT,KACKF,QAAQG,IAAR;AACN,eAHD;AAID,aALM,CADU;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAb;;AAAA;AAAA;AAAA;AAAA,GAAN;;kBASe;AACbtB,kBADa;AAEba,UAFa;AAGbG,wBAHa;AAIbF;AAJa,C","file":"db.js","sourcesContent":["import mysql from 'mysql';\nimport async from 'async';\nimport fs from 'fs';\n\nexport const TEST_DB = 'atlargetest';\nexport const PRODUCTION_DB = process.env.PRODUCTION_DB;\n\nexport const MODE_TEST = 'MODE_TEST';\nexport const MODE_PRODUCTION = 'MODE_PRODUCTION';\n\nlet state = {\n  pool: null,\n  mode: null,\n};\n\nconst connect = (mode, done) => {\n  const config = {\n    host: mode === MODE_PRODUCTION ? process.env.DATABASE_HOST : 'localhost',\n    user: mode === MODE_PRODUCTION ? process.env.MYSQL_USERNAME : 'root',\n    password: process.env.MYSQL_PASSWORD,\n    database: mode === MODE_PRODUCTION ? PRODUCTION_DB : TEST_DB,\n  };\n\n  console.log(config);\n\n  state.pool = mysql.createPool(config);\n  state.mode = mode;\n  done();\n};\n\nconst get = () => state.pool;\n\nconst disconnect = () => {\n  get().end();\n};\n\nconst queryAsync = async (query, params) => {\n  return new Promise((resolve, reject) => {\n    state.pool.query(query, params, (err, rows) => {\n      if (err) reject(err);\n      else resolve(rows);\n    });\n  });\n};\n\nexport default {\n  connect,\n  get,\n  queryAsync,\n  disconnect,\n};\n"]}